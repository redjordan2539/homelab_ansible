# {{ item.key}}.container              

########################################
# This file is managed by Ansible      #
# DO NOT EDIT THIS FILE DIRECTLY       #
# All changes must be done via Ansible #
########################################

[Unit]
After=network-online.target
After=adguard.service
Requires=adguard.service


[Container]
ContainerName={{item.key}}
DNS={{ container_dns_ip }}
Image={{ item.value.image_url }}
Network=proxy_network:ip={{container_ip_prefix }}.{{ item.value.ip_address_octet }}
AutoUpdate=registry
UserNS=keep-id

{% if item.value.published_ports %}
{% for published_port in item.value.published_ports %}
PublishPort={{ published_port.host_port }}:{{ published_port.container_port }}/{{ published_port.proto }}
{% endfor %}
{% endif %}

{% if item.value.volumes %}
{% for volume in item.value.volumes %}
Volume={{ volume.host_path }}:{{ volume.container_path }}
{% endfor %}
{% endif %}

{% if item.value.env_vars %}
{% for var in item.value.env_vars %}
Environment={{var.name}}={{var.value}}
{% endfor %}
{% endif %}

{% if item.value.devices %}
{% for device in item.value.devices %}
AddDevice={{ device }}
{% endfor %}
{% endif %}

[Service]
Restart=always

[Install]
WantedBy=default.target
