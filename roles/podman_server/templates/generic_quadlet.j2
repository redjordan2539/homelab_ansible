# {{ item.key}}.container              

########################################
# This file is managed by Ansible      #
# DO NOT EDIT THIS FILE DIRECTLY       #
# All changes must be done via Ansible #
########################################

[Unit]
After=network-online.target
After=adguard.service
Requires=adguard.service


[Container]
ContainerName={{item.key}}
DNS={{ container_dns_ip }}
Image={{ item.value.image_url }}
Network=proxy_network:ip={{ container_ip_prefix }}.{{ item.value.ip_address_octet }}
AutoUpdate=registry
UserNS=keep-id
User=0

{% for published_port in item.value.published_ports | default([], true) %}
# Ports #
PublishPort={{ published_port.host_port }}:{{ published_port.container_port }}/{{ published_port.proto }}
{% endfor %}

{% for volume in item.value.volumes | default([], true)  %}
# Volumes #
Volume={{ volume.host_path }}:{{ volume.container_path }}{% if volume.flags is defined %}:{{ volume.flags | default('', true)}}{% endif %}

{% endfor %}

{% for var in item.value.env_vars | default([], true)  %}
# Environment Variables #
Environment={{var.name}}={{var.value}}
{% endfor %}

{% for device in item.value.devices | default([], true)  %}
# Devices #
AddDevice={{ device }}
{% endfor %}

[Service]
Restart=always

[Install]
WantedBy=default.target
